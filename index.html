<html>
  <body>
    <div id="mapdiv"></div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://openlayers.org/api/OpenLayers.js"></script>
    <style>
      body {
        font-family: Arial !important;
        margin: 0
      }
      .olFramedCloudPopupContent {
        font-size: 12px
      }
    </style>
    <script>
const map = new OpenLayers.Map("mapdiv")
map.addLayer(new OpenLayers.Layer.OSM('ppvbc', null, { tileOptions: { crossOriginKeyword: null } }))
var zoom=14
var markers = new OpenLayers.Layer.Markers( "Markers" )
map.addLayer(markers);
map.zoomToExtent()
$.getJSON('data.json', (places) => {
  $(places).each((idx, place) => {
    var url
    if (place.wayId) {
      url = 'https://api.openstreetmap.org/api/0.6/way/' + place.wayId + '/full.json'
    } else if (place.relationId) {
      url = 'https://api.openstreetmap.org/api/0.6/relation/' + place.relationId + '/full.json'
    } else if (place.nodeId) {
      url = 'https://api.openstreetmap.org/api/0.6/node/' + place.nodeId + '.json'
    }
    $.get(url, (data) => {
      const node = data.elements[0]
      const e = place.wayId || place.relationId
        ? data.elements[data.elements.length - 1]
        : data.elements[0]
        const lonLat = new OpenLayers.LonLat(node.lon, node.lat)
        .transform(
          new OpenLayers.Projection("EPSG:4326"), // transform from WGS 1984
          map.getProjectionObject() // to Spherical Mercator Projection
        );
        const marker = new OpenLayers.Marker(lonLat);
        markers.addMarker(marker)
        const name = (place.name || e.tags && e.tags.name)
        const showPopup = () => {
          const popup = new OpenLayers.Popup.FramedCloud(name,
                                                         lonLat,
                                                         new OpenLayers.Size(10,10),
                                                         name.replace(/\)/, '<br/>').replace(/\(/, '<br/>').replace(/•/g, '<br/>•') + '<br/>' + place.date + '<br/>' + place.duration,
                                                         null,
                                                         true)
          map.addPopup(popup)
        }
        marker.events.register('click', marker, showPopup)
        marker.events.register('touchstart', marker, showPopup)
        map.setCenter (lonLat, zoom);

    })
  })
})

    </script>
  </body>
</html>
